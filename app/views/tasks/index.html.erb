<div class="container">

<h1> <%= t('tasks.index.title')%> </h1>
<%= link_to t('tasks.link.new'), new_task_path %>


<%= search_form_for @q do |f| %>
  <%= f.search_field :title_cont, placeholder: '輸入標題搜尋' %>
  <%= f.select :state_eq, Task.aasm.states_for_select, prompt: '選擇狀態搜尋' %>
  <%= f.submit %>
<% end %>

<table class="table text-center">
  <thead>
    <tr>
      <td> <%= t('tasks.form.title')%> </td>
      <td> <%= t('tasks.form.start_at')%> </td>
      <td> <%= sort_link(@q, :end_at, default_order: :desc) %> </td>
      <td> <%= t('tasks.form.state')%> </td>
      <td> <%= t('.state')%> </td>
      <td> <%= sort_link(@q, :priority, default_order: :asc) %>  </td>
      <td> <%= t('tasks.index.option')%> </td>
    </tr>
  </thead>
  <tbody>
    <% @tasks.each do |task| %>
      <tr>
        <td><%= link_to task.title, task %></td>
        <td><%= task.start_at&.strftime("%Y/%m/%d") %></td>
        <td><%= task.end_at&.strftime("%Y/%m/%d") %></td>
        <td><%= task.aasm.human_state %></td>
        <td>
          <%= link_to t('tasks.link.pending'),update_state_task_path(task,state: 'pend'), method: 'patch' if task.may_pend? %>
          <%= link_to t('tasks.link.progressing'),update_state_task_path(task,state: 'progress'),method: 'patch' if task.may_progress? %>
          <%= link_to t('tasks.link.finish'), update_state_task_path(task,state:'finish'), method: 'patch' if task.may_finish?%>
        </td>
        <td><%= get_priority(task.priority) %></td>
        <td>
          <%= link_to t('tasks.link.edit'), edit_task_path(task) %>
          <%= link_to t('tasks.link.delete'),task_path(task), method:'delete' %>
        </td>

      </tr>
    <% end %>
  </tbody>
</table>
  <div class="row">
    <div class="col-6 mx-auto">
      <%= paginate @tasks %>
    </div>
  </div>
</div>


